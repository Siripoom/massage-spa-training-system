{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/massage-spa-training-system/frontend/src/app/%28pages%29/admin/school-settings/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport '@ant-design/v5-patch-for-react-19';\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Form, Input, Button, message, Typography, Breadcrumb, Card, Upload, Row, Col } from 'antd';\r\nimport { SaveOutlined, HomeOutlined, SettingOutlined, UploadOutlined } from '@ant-design/icons';\r\nimport type { UploadFile, UploadProps } from 'antd/es/upload/interface';\r\n\r\nconst { Text, Title: AntdTitle } = Typography;\r\nconst { TextArea } = Input;\r\n\r\n// Interface for school data\r\ninterface SchoolData {\r\n  schoolName: string;\r\n  address: string;\r\n  phone: string;\r\n  email: string;\r\n  logoUrl?: string; // Optional logo URL\r\n  description?: string;\r\n}\r\n\r\n// Default school data for initial state\r\nconst defaultSchoolData: SchoolData = {\r\n  schoolName: '',\r\n  address: '',\r\n  phone: '',\r\n  email: '',\r\n  logoUrl: '',\r\n  description: '',\r\n};\r\n\r\nexport default function SchoolSettingsPage() {\r\n  const [form] = Form.useForm<SchoolData>();\r\n  const [loading, setLoading] = useState(true);\r\n  const [fileList, setFileList] = useState<UploadFile[]>([]); // State for Ant Design Upload component\r\n\r\n  // Load school data from localStorage on component mount\r\n  useEffect(() => {\r\n    try {\r\n      const storedData = localStorage.getItem('schoolData');\r\n      if (storedData) {\r\n        const parsedData: SchoolData = JSON.parse(storedData);\r\n        form.setFieldsValue(parsedData);\r\n        // If a logoUrl exists, set it to the fileList for display\r\n        if (parsedData.logoUrl) {\r\n          setFileList([{\r\n            uid: '-1', // Unique ID for the file\r\n            name: 'school_logo.png', // Placeholder name\r\n            status: 'done', // Mark as uploaded\r\n            url: parsedData.logoUrl, // The actual URL\r\n            thumbUrl: parsedData.logoUrl, // Thumbnail URL\r\n          }]);\r\n        }\r\n      } else {\r\n        form.setFieldsValue(defaultSchoolData);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Failed to load school data from localStorage\", error);\r\n      message.error('เกิดข้อผิดพลาดในการโหลดข้อมูลโรงเรียน');\r\n      form.setFieldsValue(defaultSchoolData);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [form]);\r\n\r\n  // Handle form submission\r\n  const onFinish = (values: SchoolData) => {\r\n    try {\r\n      // Update logoUrl from fileList if a file is present\r\n      const updatedLogoUrl = fileList.length > 0 ? fileList[0].url || fileList[0].thumbUrl : '';\r\n      const finalData = { ...values, logoUrl: updatedLogoUrl };\r\n\r\n      localStorage.setItem('schoolData', JSON.stringify(finalData));\r\n      message.success('บันทึกข้อมูลโรงเรียนเรียบร้อยแล้ว!');\r\n    } catch (error) {\r\n      console.error(\"Failed to save school data to localStorage\", error);\r\n      message.error('เกิดข้อผิดพลาดในการบันทึกข้อมูลโรงเรียน');\r\n    }\r\n  };\r\n\r\n  // Props for Ant Design Upload component\r\n  const uploadProps: UploadProps = {\r\n    onRemove: () => {\r\n      // Remove the file from state\r\n      setFileList([]);\r\n      // Clear the logoUrl from form values immediately\r\n      form.setFieldsValue({ logoUrl: '' });\r\n      message.info('ลบโลโก้โรงเรียนแล้ว');\r\n    },\r\n    beforeUpload: (file) => {\r\n      // Prevent default upload behavior (we'll handle it manually)\r\n      // Convert file to base64 for local storage or simulate upload to get a URL\r\n      return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n        reader.readAsDataURL(file);\r\n        reader.onload = () => {\r\n          const imageUrl = reader.result as string;\r\n          setFileList([{\r\n            uid: file.uid,\r\n            name: file.name,\r\n            status: 'done',\r\n            url: imageUrl,\r\n            thumbUrl: imageUrl,\r\n          }]);\r\n          form.setFieldsValue({ logoUrl: imageUrl }); // Update form field with base64 URL\r\n          message.success(`${file.name} อัปโหลดสำเร็จ`);\r\n          resolve(false); // Return false to prevent Ant Design from trying to upload\r\n        };\r\n        reader.onerror = (error) => {\r\n          message.error(`${file.name} อัปโหลดไม่สำเร็จ`);\r\n          console.error(\"File reading error:\", error);\r\n          reject(false);\r\n        };\r\n      });\r\n    },\r\n    fileList, // Controlled component\r\n    maxCount: 1, // Only allow one logo\r\n    listType: \"picture\", // Display as a picture list\r\n    accept: \"image/*\", // Accept only image files\r\n  };\r\n\r\n  const breadcrumbItems = [\r\n    {\r\n      title: <a href=\"/admin/dashboard\"><HomeOutlined /> หน้าหลัก</a>,\r\n    },\r\n    {\r\n      title: <><SettingOutlined /> ตั้งค่าโรงเรียน</>,\r\n    },\r\n  ];\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex justify-center items-center h-screen\">\r\n        <Text>กำลังโหลด...</Text>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 min-h-screen\">\r\n      <Breadcrumb className=\"mb-6\" items={breadcrumbItems} />\r\n\r\n      <AntdTitle level={1} className=\"text-3xl font-bold mb-8 text-gray-800\">\r\n        ตั้งค่าข้อมูลโรงเรียน\r\n      </AntdTitle>\r\n\r\n      <Card className=\"rounded-xl shadow-custom-light p-6\">\r\n        <Form\r\n          form={form}\r\n          layout=\"vertical\"\r\n          name=\"school_settings_form\"\r\n          onFinish={onFinish}\r\n          initialValues={defaultSchoolData}\r\n        >\r\n          <Row gutter={[24, 24]}>\r\n            <Col xs={24} md={12}>\r\n              <Form.Item\r\n                name=\"schoolName\"\r\n                label={<span className=\"font-semibold text-gray-700\">ชื่อโรงเรียน</span>}\r\n                rules={[{ required: true, message: 'กรุณากรอกชื่อโรงเรียน!' }]}\r\n              >\r\n                <Input placeholder=\"เช่น โรงเรียนนวดแผนไทย\" className=\"rounded-lg\" />\r\n              </Form.Item>\r\n              <Form.Item\r\n                name=\"address\"\r\n                label={<span className=\"font-semibold text-gray-700\">ที่อยู่</span>}\r\n                rules={[{ required: true, message: 'กรุณากรอกที่อยู่โรงเรียน!' }]}\r\n              >\r\n                <TextArea rows={3} placeholder=\"เช่น 123 ถนนสุขุมวิท แขวงคลองเตย เขตคลองเตย กรุงเทพมหานคร 10110\" className=\"rounded-lg\" />\r\n              </Form.Item>\r\n              <Form.Item\r\n                name=\"phone\"\r\n                label={<span className=\"font-semibold text-gray-700\">เบอร์โทรศัพท์</span>}\r\n                rules={[{ required: true, message: 'กรุณากรอกเบอร์โทรศัพท์!' }]}\r\n              >\r\n                <Input placeholder=\"เช่น 02-123-4567\" className=\"rounded-lg\" />\r\n              </Form.Item>\r\n              <Form.Item\r\n                name=\"email\"\r\n                label={<span className=\"font-semibold text-gray-700\">อีเมล</span>}\r\n                rules={[{ required: true, message: 'กรุณากรอกอีเมล!', type: 'email' }]}\r\n              >\r\n                <Input placeholder=\"เช่น info@school.com\" className=\"rounded-lg\" />\r\n              </Form.Item>\r\n            </Col>\r\n            <Col xs={24} md={12}>\r\n              <Form.Item\r\n                name=\"description\"\r\n                label={<span className=\"font-semibold text-gray-700\">คำอธิบายโรงเรียน (ไม่บังคับ)</span>}\r\n              >\r\n                <TextArea rows={5} placeholder=\"คำอธิบายสั้นๆ เกี่ยวกับโรงเรียน\" className=\"rounded-lg\" />\r\n              </Form.Item>\r\n              <Form.Item\r\n                label={<span className=\"font-semibold text-gray-700\">ตราโรงเรียน (โลโก้)</span>}\r\n              >\r\n                <Upload {...uploadProps}>\r\n                  <Button icon={<UploadOutlined />} className=\"rounded-lg\">อัปโหลดโลโก้</Button>\r\n                </Upload>\r\n                {/* Hidden input to store logoUrl in form data, updated by uploadProps.beforeUpload */}\r\n                <Input type=\"hidden\" name=\"logoUrl\" />\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n\r\n          <Form.Item className=\"mt-8\">\r\n            <Button\r\n              type=\"primary\"\r\n              htmlType=\"submit\"\r\n              icon={<SaveOutlined />}\r\n              className=\"bg-blue-500 hover:bg-blue-600 text-white rounded-lg shadow-md px-6 py-3 text-base\"\r\n            >\r\n              บันทึกข้อมูลโรงเรียน\r\n            </Button>\r\n          </Form.Item>\r\n        </Form>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}