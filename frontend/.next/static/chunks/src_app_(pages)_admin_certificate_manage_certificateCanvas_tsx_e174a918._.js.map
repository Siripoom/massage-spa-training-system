{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/massage-spa-training-system/frontend/src/app/%28pages%29/admin/certificate/manage/certificateCanvas.tsx"],"sourcesContent":["'use client';\r\n\r\n\r\nimport '@ant-design/v5-patch-for-react-19';\r\nimport React, { useRef, useEffect, useState, useCallback } from 'react';\r\nimport { Stage, Layer, Text, Rect, Image as KonvaImage } from 'react-konva';\r\nimport Konva from 'konva';\r\nimport dayjs from 'dayjs';\r\n\r\n// Base dimensions for the certificate design (A4 landscape ratio)\r\nconst DESIGN_WIDTH = 720;\r\nconst DESIGN_HEIGHT = 508.5;\r\n\r\ninterface CertificateData {\r\n  backgroundColor: string;\r\n  textColor: string;\r\n  fontFamily: string;\r\n  fontSize: number; // Base font size\r\n  titleText: string;\r\n  studentNamePlaceholder: string; // Placeholder for student name\r\n  courseNamePlaceholder: string; // Placeholder for course name\r\n  issueDatePlaceholder: string; // Placeholder for issue date\r\n  signatureText: string;\r\n  signatureLine2: string; // Additional signature line\r\n  logoUrl?: string;\r\n\r\n  titlePosX: number;\r\n  titlePosY: number;\r\n  studentNamePosX: number;\r\n  studentNamePosY: number;\r\n  courseNamePosX: number;\r\n  courseNamePosY: number;\r\n  issueDateTextPosX: number;\r\n  issueDateTextPosY: number;\r\n  issueDateValuePosX: number;\r\n  issueDateValuePosY: number;\r\n  signatureBlockPosX: number;\r\n  signatureBlockPosY: number;\r\n\r\n  mainBorderWidth: number;\r\n  mainBorderColor: string;\r\n  mainBorderRadius: number;\r\n  mainBorderStyle: 'solid' | 'dashed';\r\n  mainBorderDashLength: number;\r\n  mainBorderDashGap: number;\r\n  innerBorder1Width: number;\r\n  innerBorder1Color: string;\r\n  innerBorder1DashLength: number;\r\n  innerBorder1DashGap: number;\r\n  innerBorder2Width: number;\r\n  innerBorder2Color: string;\r\n}\r\n\r\ninterface CertificateCanvasProps {\r\n  certificateData: CertificateData;\r\n  onPositionChange: (elementName: string, newPos: { x: number; y: number }) => void;\r\n  stageRef: React.RefObject<Konva.Stage | null>;\r\n}\r\n\r\nconst CertificateCanvas: React.FC<CertificateCanvasProps> = ({ certificateData, stageRef }) => {\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const [stageWidth, setStageWidth] = useState(DESIGN_WIDTH);\r\n  const [stageHeight, setStageHeight] = useState(DESIGN_HEIGHT);\r\n  const [scale, setScale] = useState(1);\r\n  const [logoKonvaImage, setLogoKonvaImage] = useState<HTMLImageElement | null>(null);\r\n\r\n  const checkSize = useCallback(() => {\r\n    if (containerRef.current) {\r\n      const containerWidth = containerRef.current.offsetWidth;\r\n      const newScale = containerWidth / DESIGN_WIDTH;\r\n      setStageWidth(containerWidth);\r\n      setStageHeight(DESIGN_HEIGHT * newScale);\r\n      setScale(newScale);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    checkSize();\r\n    window.addEventListener('resize', checkSize);\r\n    const timeoutId = setTimeout(checkSize, 0);\r\n    return () => {\r\n      window.removeEventListener('resize', checkSize);\r\n      clearTimeout(timeoutId);\r\n    };\r\n  }, [checkSize]);\r\n\r\n  useEffect(() => {\r\n    if (certificateData.logoUrl) {\r\n      const img = new window.Image();\r\n      img.src = certificateData.logoUrl;\r\n      img.crossOrigin = 'Anonymous';\r\n      img.onload = () => {\r\n        setLogoKonvaImage(img);\r\n      };\r\n      img.onerror = () => {\r\n        console.error(\"Failed to load logo image for Konva:\", certificateData.logoUrl);\r\n        setLogoKonvaImage(null);\r\n      };\r\n    } else {\r\n      setLogoKonvaImage(null);\r\n    }\r\n  }, [certificateData.logoUrl]);\r\n\r\n  // Function to render text with common properties (no dragging)\r\n  const renderTextElement = (\r\n    text: string,\r\n    x: number,\r\n    y: number,\r\n    fontSize: number,\r\n    align: Konva.Text['attrs']['align'] = 'center',\r\n    width?: number // Optional width for alignment\r\n  ) => (\r\n    <Text\r\n      text={text}\r\n      x={x * scale}\r\n      y={y * scale}\r\n      fontSize={fontSize * scale}\r\n      fontFamily={certificateData.fontFamily}\r\n      fill={certificateData.textColor}\r\n      align={align}\r\n      width={width ? width * scale : undefined}\r\n    />\r\n  );\r\n\r\n  return (\r\n    <div ref={containerRef} style={{\r\n      width: '100%',\r\n      aspectRatio: `${DESIGN_WIDTH} / ${DESIGN_HEIGHT}`,\r\n      position: 'relative',\r\n    }}>\r\n      <Stage\r\n        width={stageWidth}\r\n        height={stageHeight}\r\n        ref={stageRef}\r\n      >\r\n        <Layer>\r\n          {/* Background and Borders */}\r\n          <Rect\r\n            x={0}\r\n            y={0}\r\n            width={DESIGN_WIDTH}\r\n            height={DESIGN_HEIGHT}\r\n            fill={certificateData.backgroundColor}\r\n            stroke={certificateData.mainBorderColor}\r\n            strokeWidth={certificateData.mainBorderWidth}\r\n            cornerRadius={certificateData.mainBorderRadius}\r\n            dash={certificateData.mainBorderStyle === 'dashed' ? [certificateData.mainBorderDashLength, certificateData.mainBorderDashGap] : undefined}\r\n          />\r\n          <Rect\r\n            x={20 * scale}\r\n            y={20 * scale}\r\n            width={DESIGN_WIDTH * scale - 40 * scale}\r\n            height={DESIGN_HEIGHT * scale - 40 * scale}\r\n            stroke={certificateData.innerBorder1Color}\r\n            strokeWidth={certificateData.innerBorder1Width}\r\n            cornerRadius={6 * scale}\r\n            dash={[certificateData.innerBorder1DashLength, certificateData.innerBorder1DashGap]}\r\n          />\r\n          <Rect\r\n            x={25 * scale}\r\n            y={25 * scale}\r\n            width={DESIGN_WIDTH * scale - 50 * scale}\r\n            height={DESIGN_HEIGHT * scale - 50 * scale}\r\n            stroke={certificateData.innerBorder2Color}\r\n            strokeWidth={certificateData.innerBorder2Width}\r\n            cornerRadius={5 * scale}\r\n          />\r\n\r\n          {/* School Logo */}\r\n          {logoKonvaImage && (\r\n            <KonvaImage\r\n              image={logoKonvaImage}\r\n              x={20 * scale}\r\n              y={20 * scale}\r\n              width={100 * scale}\r\n              height={100 * scale}\r\n            />\r\n          )}\r\n\r\n          {/* Title */}\r\n          {renderTextElement(\r\n            certificateData.titleText,\r\n            0, // Set x to 0 for center alignment\r\n            certificateData.titlePosY,\r\n            certificateData.fontSize + 10,\r\n            'center',\r\n            DESIGN_WIDTH // Ensure width is DESIGN_WIDTH for center alignment\r\n          )}\r\n\r\n          {/* \"มอบให้แก่\" - Fixed text, centered */}\r\n          {renderTextElement(\r\n            \"มอบให้แก่\",\r\n            0, // Set x to 0 for center alignment\r\n            DESIGN_HEIGHT * 0.30,\r\n            certificateData.fontSize,\r\n            'center',\r\n            DESIGN_WIDTH // Ensure width is DESIGN_WIDTH for center alignment\r\n          )}\r\n\r\n          {/* Student Name */}\r\n          {renderTextElement(\r\n            certificateData.studentNamePlaceholder,\r\n            0, // Set x to 0 for center alignment\r\n            certificateData.studentNamePosY,\r\n            certificateData.fontSize + 6,\r\n            'center',\r\n            DESIGN_WIDTH // Ensure width is DESIGN_WIDTH for center alignment\r\n          )}\r\n\r\n          {/* \"เพื่อแสดงว่าได้สำเร็จหลักสูตร\" - Fixed text, centered */}\r\n          {renderTextElement(\r\n            \"เพื่อแสดงว่าได้สำเร็จหลักสูตร\",\r\n            0, // Set x to 0 for center alignment\r\n            DESIGN_HEIGHT * 0.55,\r\n            certificateData.fontSize,\r\n            'center',\r\n            DESIGN_WIDTH // Ensure width is DESIGN_WIDTH for center alignment\r\n          )}\r\n\r\n          {/* Course Name */}\r\n          {renderTextElement(\r\n            certificateData.courseNamePlaceholder,\r\n            0, // Set x to 0 for center alignment\r\n            certificateData.courseNamePosY,\r\n            certificateData.fontSize + 6,\r\n            'center',\r\n            DESIGN_WIDTH // Ensure width is DESIGN_WIDTH for center alignment\r\n          )}\r\n\r\n          {/* \"ณ วันที่\" - Text, left-aligned relative to its X */}\r\n          {renderTextElement(\r\n            \"ณ วันที่\",\r\n            certificateData.issueDateTextPosX,\r\n            certificateData.issueDateTextPosY,\r\n            certificateData.fontSize - 8,\r\n            'left'\r\n          )}\r\n\r\n          {/* Issue Date Value - Text, left-aligned relative to its X */}\r\n          {renderTextElement(\r\n            certificateData.issueDatePlaceholder || dayjs().format('DD MMMM YYYY'), // Use placeholder or current date\r\n            certificateData.issueDateValuePosX,\r\n            certificateData.issueDateValuePosY,\r\n            certificateData.fontSize - 8,\r\n            'left'\r\n          )}\r\n\r\n          {/* Signature Lines - Text block, right-aligned relative to its X */}\r\n          {renderTextElement(\r\n            `(_________________________)\\n\\n${certificateData.signatureText}\\n${certificateData.signatureLine2}`,\r\n            certificateData.signatureBlockPosX,\r\n            certificateData.signatureBlockPosY,\r\n            certificateData.fontSize - 12,\r\n            'right',\r\n            200 // Fixed width for signature block\r\n          )}\r\n        </Layer>\r\n      </Stage>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CertificateCanvas;\r\n"],"names":[],"mappings":"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","debugId":null}}]
}