{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Admin/massage-spa-training-system/frontend/src/app/%28pages%29/admin/certificate/certificateCanvas.tsx"],"sourcesContent":["// src/app/admin/certificate/CertificateCanvas.tsx\r\n// Component สำหรับแสดงผลและออกแบบใบประกาศด้วย Konva.js\r\n'use client';\r\n\r\nimport React, { useRef, useEffect, useState, useCallback } from 'react';\r\n// import { Stage, Layer, Text, Image as KonvaImage, Rect } from 'react-konva';\r\nimport { Stage, Layer, Text, Rect } from 'react-konva';\r\nimport Konva from 'konva';\r\n// import useImage from 'use-image'; \r\nimport dayjs from 'dayjs';\r\n\r\n// Base dimensions for the certificate design (A4 landscape ratio)\r\nconst DESIGN_WIDTH = 720; \r\nconst DESIGN_HEIGHT = 508.5; \r\n\r\ninterface CertificateData {\r\n  title: string;\r\n  studentName: string;\r\n  courseName: string;\r\n  issueDate: dayjs.Dayjs | null;\r\n  schoolLogoUrl: string;\r\n  fontFamily: string;\r\n  fontSize: number;\r\n  textColor: string;\r\n  bgColor: string;\r\n  signatureLine1: string;\r\n  signatureLine2: string;\r\n  // Positions for Konva shapes (all in pixels, representing the TOP-LEFT of the element's bounding box)\r\n  titlePos: { x: number; y: number };\r\n  studentNamePos: { x: number; y: number };\r\n  courseNamePos: { x: number; y: number };\r\n\r\n  // *** เพิ่ม Properties สำหรับการปรับแต่งกรอบ ***\r\n  mainBorderWidth: number;\r\n  mainBorderColor: string;\r\n  mainBorderRadius: number;\r\n  mainBorderStyle: 'solid' | 'dashed'; // เพิ่มสไตล์เส้นกรอบหลัก\r\n  mainBorderDashLength: number; // ความยาวเส้นประกรอบหลัก\r\n  mainBorderDashGap: number; // ระยะห่างเส้นประกรอบหลัก\r\n  innerBorder1Width: number;\r\n  innerBorder1Color: string;\r\n  innerBorder1DashLength: number;\r\n  innerBorder1DashGap: number;\r\n  innerBorder2Width: number;\r\n  innerBorder2Color: string;\r\n}\r\n\r\ninterface CertificateCanvasProps {\r\n  certificateData: CertificateData;\r\n  onPositionChange: (elementName: string, newPos: { x: number; y: number }) => void;\r\n  stageRef: React.RefObject<Konva.Stage | null>; // Pass ref to Stage for export\r\n}\r\n\r\nconst CertificateCanvas: React.FC<CertificateCanvasProps> = ({ certificateData, onPositionChange, stageRef }) => {\r\n  // const [logoImage] = useImage(certificateData.schoolLogoUrl); \r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const [stageWidth, setStageWidth] = useState(DESIGN_WIDTH);\r\n  const [stageHeight, setStageHeight] = useState(DESIGN_HEIGHT);\r\n  const [scale, setScale] = useState(1);\r\n\r\n  // Function to calculate stage size based on container\r\n  const checkSize = useCallback(() => {\r\n    if (containerRef.current) {\r\n      const containerWidth = containerRef.current.offsetWidth;\r\n      const newScale = containerWidth / DESIGN_WIDTH;\r\n      setStageWidth(containerWidth);\r\n      setStageHeight(DESIGN_HEIGHT * newScale);\r\n      setScale(newScale);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    checkSize();\r\n    window.addEventListener('resize', checkSize);\r\n    return () => window.removeEventListener('resize', checkSize);\r\n  }, [checkSize]);\r\n\r\n  // Handler for all draggable elements (text) drag end\r\n  const handleDragEnd = (e: Konva.KonvaEventObject<DragEvent>, elementName: string) => {\r\n    // Konva's x, y for Text are top-left. We store top-left in certificateData.\r\n    // For draggable text, we want to store the center X and top Y.\r\n    const newX = (e.target.x() + e.target.width() / 2) / scale; \r\n    const newY = e.target.y() / scale; \r\n    onPositionChange(elementName, { x: newX, y: newY });\r\n  };\r\n\r\n  return (\r\n    <div ref={containerRef} style={{ \r\n      width: '100%', \r\n      aspectRatio: `${DESIGN_WIDTH} / ${DESIGN_HEIGHT}`, \r\n      position: 'relative', \r\n      overflow: 'hidden',\r\n    }}>\r\n      <Stage\r\n        width={stageWidth}\r\n        height={stageHeight}\r\n        ref={stageRef} // Pass the ref from parent\r\n      >\r\n        <Layer>\r\n          {/* Outer Border Rectangle (for formal Thai style) */}\r\n          <Rect\r\n            x={0}\r\n            y={0}\r\n            width={DESIGN_WIDTH}\r\n            height={DESIGN_HEIGHT}\r\n            fill={certificateData.bgColor}\r\n            stroke={certificateData.mainBorderColor}\r\n            strokeWidth={certificateData.mainBorderWidth}\r\n            cornerRadius={certificateData.mainBorderRadius}\r\n            // lineCap={certificateData.mainBorderLineCap} // ลบออก\r\n            // lineJoin={certificateData.mainBorderLineJoin} // ลบออก\r\n            // Apply dash property based on mainBorderStyle\r\n            dash={certificateData.mainBorderStyle === 'dashed' ? [certificateData.mainBorderDashLength, certificateData.mainBorderDashGap] : undefined}\r\n          />\r\n          {/* Inner Decorative Border (simulating a more formal look) */}\r\n          <Rect\r\n            x={20} \r\n            y={20}\r\n            width={DESIGN_WIDTH - 40}\r\n            height={DESIGN_HEIGHT - 40}\r\n            stroke={certificateData.innerBorder1Color} \r\n            strokeWidth={certificateData.innerBorder1Width} \r\n            cornerRadius={6}\r\n            dash={[certificateData.innerBorder1DashLength, certificateData.innerBorder1DashGap]} \r\n          />\r\n          <Rect\r\n            x={25} \r\n            y={25}\r\n            width={DESIGN_WIDTH - 50}\r\n            height={DESIGN_HEIGHT - 50}\r\n            stroke={certificateData.innerBorder2Color} \r\n            strokeWidth={certificateData.innerBorder2Width} \r\n            cornerRadius={5}\r\n          />\r\n\r\n          {/* School Logo (ถูกคอมเมนต์ออกชั่วคราวตามคำขอ) */}\r\n          {/* {logoImage && (\r\n            <KonvaImage\r\n              image={logoImage}\r\n              x={certificateData.logoPos.x} \r\n              y={certificateData.logoPos.y} \r\n              width={100}\r\n              height={100}\r\n              draggable\r\n              onDragEnd={(e) => handleDragEnd(e, 'logo')}\r\n              crossOrigin=\"anonymous\" \r\n            />\r\n          )} */}\r\n\r\n          {/* Title */}\r\n          <Text\r\n            text={certificateData.title}\r\n            x={certificateData.titlePos.x} \r\n            y={certificateData.titlePos.y} \r\n            fontSize={certificateData.fontSize + 10}\r\n            fontFamily={certificateData.fontFamily}\r\n            fill={certificateData.textColor}\r\n            align=\"center\"\r\n            width={DESIGN_WIDTH} \r\n            draggable\r\n            onDragEnd={(e) => handleDragEnd(e, 'title')}\r\n            offsetX={DESIGN_WIDTH / 2} \r\n          />\r\n\r\n          {/* \"มอบให้แก่\" */}\r\n          <Text\r\n            text=\"มอบให้แก่\"\r\n            x={DESIGN_WIDTH / 2}\r\n            y={DESIGN_HEIGHT * 0.30} \r\n            fontSize={certificateData.fontSize}\r\n            fontFamily={certificateData.fontFamily}\r\n            fill={certificateData.textColor}\r\n            align=\"center\"\r\n            width={DESIGN_WIDTH}\r\n            offsetX={DESIGN_WIDTH / 2}\r\n          />\r\n\r\n          {/* Student Name */}\r\n          <Text\r\n            text={certificateData.studentName}\r\n            x={certificateData.studentNamePos.x} \r\n            y={certificateData.studentNamePos.y}\r\n            fontSize={certificateData.fontSize + 6}\r\n            fontFamily={certificateData.fontFamily}\r\n            fill={certificateData.textColor}\r\n            align=\"center\"\r\n            width={DESIGN_WIDTH}\r\n            draggable\r\n            onDragEnd={(e) => handleDragEnd(e, 'studentName')}\r\n            offsetX={DESIGN_WIDTH / 2} \r\n          />\r\n\r\n          {/* \"เพื่อแสดงว่าได้สำเร็จหลักสูตร\" */}\r\n          <Text\r\n            text=\"เพื่อแสดงว่าได้สำเร็จหลักสูตร\"\r\n            x={DESIGN_WIDTH / 2}\r\n            y={DESIGN_HEIGHT * 0.55} \r\n            fontSize={certificateData.fontSize}\r\n            fontFamily={certificateData.fontFamily}\r\n            fill={certificateData.textColor}\r\n            align=\"center\"\r\n            width={DESIGN_WIDTH}\r\n            offsetX={DESIGN_WIDTH / 2}\r\n          />\r\n\r\n          {/* Course Name */}\r\n          <Text\r\n            text={certificateData.courseName}\r\n            x={certificateData.courseNamePos.x} \r\n            y={certificateData.courseNamePos.y}\r\n            fontSize={certificateData.fontSize + 6}\r\n            fontFamily={certificateData.fontFamily}\r\n            fill={certificateData.textColor}\r\n            align=\"center\"\r\n            width={DESIGN_WIDTH}\r\n            draggable\r\n            onDragEnd={(e) => handleDragEnd(e, 'courseName')}\r\n            offsetX={DESIGN_WIDTH / 2} \r\n          />\r\n\r\n          {/* Issue Date */}\r\n          <Text\r\n            text={`ณ วันที่ ${certificateData.issueDate ? certificateData.issueDate.format('DD MMMM YYYY') : 'วันที่ออก'}`}\r\n            x={DESIGN_WIDTH / 2}\r\n            y={DESIGN_HEIGHT * 0.70} \r\n            fontSize={certificateData.fontSize - 4}\r\n            fontFamily={certificateData.fontFamily}\r\n            fill={certificateData.textColor}\r\n            align=\"center\"\r\n            width={DESIGN_WIDTH}\r\n            offsetX={DESIGN_WIDTH / 2}\r\n          />\r\n\r\n          {/* Signature Lines */}\r\n          <Text\r\n            text={`(_________________________)\\n${certificateData.signatureLine1}\\n${certificateData.signatureLine2}`}\r\n            x={DESIGN_WIDTH - 250} \r\n            y={DESIGN_HEIGHT - 100} \r\n            fontSize={certificateData.fontSize - 4}\r\n            fontFamily={certificateData.fontFamily}\r\n            fill={certificateData.textColor}\r\n            align=\"right\" \r\n            width={200} \r\n          />\r\n        </Layer>\r\n      </Stage>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CertificateCanvas;\r\n"],"names":[],"mappings":"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","debugId":null}}]
}